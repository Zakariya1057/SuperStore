//
//  EditListItemPresenter.swift
//  SuperStore
//
//  Created by Zakariya Mohummed on 05/03/2021.
//  Copyright (c) 2021 Zakariya Mohummed. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

protocol EditListItemPresentationLogic
{
    func presentListItem(response: EditListItem.GetListItem.Response)
    func presentListItemDeleted(response: EditListItem.DeleteListItem.Response)
    func presentListItemUpdated(response: EditListItem.UpdateListItem.Response)
}

class EditListItemPresenter: EditListItemPresentationLogic
{

    weak var viewController: EditListItemDisplayLogic?
    
    // MARK: Do something
    
    func presentListItem(response: EditListItem.GetListItem.Response)
    {
        let listItem = response.listItem
        var displayPromotion: EditListItem.DisplayedPromotion?
        
        let currency: String = "Â£"
        
        if let promotion = listItem.promotion {
            displayPromotion = EditListItem.DisplayedPromotion(name: promotion.name)
        }
        
        let displayedListItem = EditListItem.DisplayedListItem(
            name: listItem.name,
            image: listItem.image,
            quantity: listItem.quantity,
            price: formatPrice(price: listItem.totalPrice, currency: currency),
            promotion: displayPromotion
        )
        
        let viewModel = EditListItem.GetListItem.ViewModel(displayedListItem: displayedListItem)
        viewController?.displayListItem(viewModel: viewModel)
    }
    
    func presentListItemUpdated(response: EditListItem.UpdateListItem.Response) {
        let viewModel = EditListItem.UpdateListItem.ViewModel(error: response.error)
        viewController?.displayListItemUpdate(viewModel: viewModel)
    }
    
    func presentListItemDeleted(response: EditListItem.DeleteListItem.Response){
        let viewModel = EditListItem.DeleteListItem.ViewModel(error: response.error)
        viewController?.displayListItemDeleted(viewModel: viewModel)
    }
}

extension EditListItemPresenter {
    private func formatPrice(price: Double, currency: String) -> String {
        return "\(currency)\(String(format: "%.2f", price))"
    }
}
